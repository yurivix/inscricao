<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Inscrição OAB-ES</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>Inscrição OAB-ES</h1>
    <form id="uploadForm" enctype="multipart/form-data">
      <div id="inputsContainer"></div>

      <div class="checkbox-container">
        <input type="checkbox" id="naoPossuiReservista" name="naoPossuiReservista">
        <label for="naoPossuiReservista">Não possuo Certificado de Reservista</label>
      </div>

      <button type="submit">Gerar PDF Final</button>
      <p id="status"></p>
    </form>
  </div>

  <script>
    const documentos = [
      "Requerimento de inscrição da OAB-ES",
      "Requerimento de inscrição no Conselho Federal da OAB",
      "Histórico Escolar com diploma ou colação de grau (autenticado)",
      "Certidão Negativa Cartório Distribuidor Justiça Federal",
      "Certificado de Aprovação em Exame de Ordem",
      "Certidão Negativa - Cartório Distribuidor do Crime",
      "Certidão Negativa - Cartório Distribuidor do Cível",
      "Certidão Negativa - Cartório Distribuidor da Família",
      "Certidão Negativa - Cartório Distribuidor do Crime Federal 2ª Região",
      "Certidão Negativa - Cartório Distribuidor Cível Federal 2ª Região",
      "Declaração de atividade, função ou cargo (com ou sem atividade)",
      "Declaração de atividade da pessoa jurídica vinculada",
      "Certidão de quitação eleitoral",
      "RG",
      "CPF",
      "Título de Eleitor (frente/verso)",
      "Certificado de Reservista (para homens)",
      "Comprovante de residência atualizado",
      "Declaração de responsabilidade das informações"
    ];

    const inputsContainer = document.getElementById("inputsContainer");

    documentos.forEach((doc, i) => {
      const div = document.createElement("div");
      div.className = "input-group";
      div.innerHTML = `
        <label for="arquivo${i}">${i + 1}. ${doc}</label>
        <input type="file" id="arquivo${i}" name="arquivos" accept=".pdf,.jpg,.jpeg,.png">
      `;
      inputsContainer.appendChild(div);
    });

    const reservistaCheckbox = document.getElementById("naoPossuiReservista");
    reservistaCheckbox.addEventListener("change", () => {
      document.getElementById("arquivo16").disabled = reservistaCheckbox.checked;
    });

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData();
      const inputs = document.querySelectorAll('input[type="file"]');

      inputs.forEach((input, index) => {
        if (index === 16 && reservistaCheckbox.checked) return;
        if (input.files[0]) {
          formData.append("arquivos", input.files[0], `${index}_${documentos[index]}`);
        }
      });

      formData.append("nao_possui_reservista", reservistaCheckbox.checked);

      const status = document.getElementById("status");
      status.textContent = "Gerando PDF...";

      const res = await fetch("/gerar_pdf", {
        method: "POST",
        body: formData
      });

      if (res.ok) {
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Inscricao_OAB_ES.pdf";
        a.click();
        URL.revokeObjectURL(url);
        status.textContent = "PDF gerado com sucesso!";
      } else {
        status.textContent = "Erro ao gerar o PDF.";
      }
    });
  </script>
</body>
</html>
